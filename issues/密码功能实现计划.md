# 密码功能实现计划

## 执行时间
2025-08-17

## 需求描述
添加密码功能，欢迎页添加密码输入框，登录快速笔记这里也添加密码输入框。登录之后可以在设置里设置密码。设置过密码的账号登录就需要输入密码了。没设置过的还是之前的逻辑。

## 核心逻辑
- **两步式登录**：先输入用户名检查是否设置密码，再根据情况要求输入密码或直接登录
- **向后兼容**：未设置密码的用户保持原有登录逻辑
- **密码管理**：在设置页面提供密码设置、修改、移除功能

## 详细执行步骤

### 步骤1：检查密码哈希库依赖 ✅
- **文件**：`package.json`
- **操作**：检查是否已安装bcryptjs，如未安装则添加
- **预期结果**：确保有密码哈希功能支持

### 步骤2：添加密码验证API
- **文件**：`app/actions/setting-actions.ts`
- **操作**：添加`verifyUserPassword`函数，用于验证用户输入的密码
- **预期结果**：提供密码验证接口

### 步骤3：扩展AuthProvider认证逻辑
- **文件**：`components/auth-provider.tsx`
- **操作**：
  - 添加`checkUserHasPassword`方法
  - 添加`loginWithPassword`方法
  - 保持原有`login`方法用于无密码登录
- **预期结果**：支持密码和无密码两种登录方式

### 步骤4：修改LoginForm组件
- **文件**：`components/login-form.tsx`
- **操作**：
  - 添加登录步骤状态管理（用户名 → 密码检查 → 登录）
  - 实现两步式UI：先输入用户名，再根据需要输入密码
  - 处理密码验证错误
- **预期结果**：支持两步式登录流程

### 步骤5：修改OnboardingAnimation组件
- **文件**：`components/onboarding-animation.tsx`
- **操作**：
  - 在最后一步添加密码检查逻辑
  - 支持新用户直接登录或输入密码登录
- **预期结果**：欢迎页支持密码功能

### 步骤6：扩展SettingsDialog组件
- **文件**：`components/settings-dialog.tsx`
- **操作**：
  - 添加密码设置区域
  - 实现设置密码、修改密码、移除密码功能
- **预期结果**：用户可以在设置中管理密码

### 步骤7：测试和验证
- **操作**：
  - 测试新用户注册流程
  - 测试已有用户（无密码）登录
  - 测试设置密码后的登录流程
  - 测试密码管理功能
- **预期结果**：所有场景都能正常工作

## 预计完成时间
约60-80分钟，包括测试验证。
