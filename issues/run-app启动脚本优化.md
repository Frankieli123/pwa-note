# run-app.bat 启动脚本完整重写

## 任务背景
修复 run-app.bat 脚本的乱码问题，并为全新机器提供完整的环境检查和自动配置功能。

## 问题分析
1. **乱码问题**：中文字符在某些系统上显示异常
2. **端口混乱**：脚本中端口号不一致（8080、8081）
3. **环境检查缺失**：没有检查 Node.js 版本和包管理器
4. **配置检查缺失**：没有验证 .env.local 文件
5. **包管理器不匹配**：项目使用 pnpm 但脚本使用 npm

## 解决方案

### 1. 编码修复
- 添加 `chcp 65001` 设置 UTF-8 编码
- 确保中文字符正确显示

### 2. 环境检查
- **Node.js 版本检查**：确保版本 >= 18
- **包管理器检测**：按优先级 pnpm > yarn > npm
- **自动安装 pnpm**：如检测到 pnpm-lock.yaml 但未安装 pnpm

### 3. 配置验证
- **检查 .env.local**：确保环境配置文件存在
- **依赖检查**：验证 node_modules 目录
- **端口检测**：检查默认端口 3000 是否可用

### 4. 用户体验优化
- **进度显示**：6步骤进度指示器
- **清晰提示**：详细的错误信息和解决建议
- **统一端口**：使用 Next.js 默认的 3000 端口
- **窗口标题**：为服务器窗口设置标题

### 5. 错误处理
- **详细错误信息**：提供具体的解决步骤
- **优雅退出**：错误时暂停并提示用户
- **故障排除指南**：常见问题的解决方案

## 实现细节

### 关键功能
1. **自动包管理器检测**：根据锁文件选择合适的包管理器
2. **智能依赖安装**：仅在需要时安装依赖
3. **端口冲突处理**：检测端口占用并提示
4. **环境配置验证**：确保必要的配置文件存在

### 用户友好特性
- 彩色状态指示器（✅ ❌ ⚠️ 📦 🚀 🌐）
- 分步骤进度显示
- 详细的启动信息
- 故障排除指南

## 测试场景
1. **全新机器**：Node.js 未安装
2. **版本过低**：Node.js 版本 < 18
3. **缺少依赖**：node_modules 不存在
4. **配置缺失**：.env.local 文件不存在
5. **端口占用**：3000 端口被占用
6. **包管理器不匹配**：有 pnpm-lock.yaml 但使用 npm

## 预期效果
- ✅ 解决中文乱码问题
- ✅ 提供完整的环境检查
- ✅ 自动处理依赖安装
- ✅ 统一端口使用
- ✅ 改善用户体验
- ✅ 支持全新机器快速启动

## 完成状态
- [x] 重写启动脚本
- [x] 添加环境检查
- [x] 修复编码问题
- [x] 优化用户体验
- [x] 创建任务记录

任务已完成，脚本现在支持在全新机器上的完整环境检查和自动配置。
