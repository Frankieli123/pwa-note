# PWA Note 文件上传功能重构

## 项目概述
将 PWA Note 应用的文件上传功能从本地存储迁移到专用文件服务器，实现统一的文件管理和更好的用户体验。

## 问题陈述
当前 PWA Note 应用的文件上传功能存在以下问题：
1. 图片和文档分别使用不同的存储方式，缺乏统一性
2. 本地存储限制了文件的可访问性和同步能力
3. 缺少服务器端的文件处理能力（如缩略图生成）
4. 文件管理和维护困难

## 目标和目的
1. 统一所有文件（图片和文档）的上传和存储方式
2. 利用已部署的文件服务器 (124.243.146.198:3001) 
3. 提供更好的文件管理和用户体验
4. 支持服务器端缩略图生成
5. 实现文件的跨设备同步访问

## 目标用户
- PWA Note 应用的所有用户
- 需要上传和管理文件的用户

## 功能和需求

### 核心功能
1. **统一文件上传**
   - 图片上传到文件服务器
   - 文档上传到文件服务器
   - 支持拖拽和点击上传

2. **文件类型支持**
   - 图片：JPEG, PNG, GIF, WebP (最大 5MB)
   - 文档：PDF, DOC, DOCX, TXT, XLS, XLSX, CSV (最大 20MB)

3. **服务器端处理**
   - 自动生成图片缩略图 (200x200)
   - 文件类型验证
   - 文件大小检查

4. **文件管理**
   - 文件列表显示
   - 文件删除功能
   - 文件下载功能
   - 缩略图预览

5. **用户体验**
   - 上传进度显示
   - 错误处理和提示
   - 响应式设计

## 技术需求

### 前端修改
1. **API 配置更新**
   - 修改上传 URL 指向文件服务器
   - 配置 CORS 和请求头

2. **组件更新**
   - sync-provider.tsx: 更新 uploadFile 函数
   - file-uploader.tsx: 调整文件类型配置
   - file-grid.tsx: 支持服务器 URL 显示
   - UploadDialogs.tsx: 统一上传逻辑

3. **错误处理**
   - 网络错误处理
   - 文件大小超限提示
   - 文件类型不支持提示

### 后端集成
1. **文件服务器 API**
   - POST /api/upload (文件上传)
   - DELETE /api/delete/:userId/:filename (文件删除)
   - GET /uploads/:userId/:filename (文件访问)

2. **数据库更新**
   - 存储服务器文件 URL
   - 存储缩略图 URL
   - 文件元数据管理

## 成功指标
1. **功能性指标**
   - 图片上传成功率 > 99%
   - 文档上传成功率 > 99%
   - 文件显示正确率 100%

2. **性能指标**
   - 文件上传响应时间 < 5秒
   - 缩略图生成时间 < 2秒
   - 文件列表加载时间 < 1秒

3. **用户体验指标**
   - 无控制台错误
   - 上传进度显示正常
   - 错误提示清晰明确

## 时间线
1. **第一阶段** (1-2小时): API 配置和基础集成
2. **第二阶段** (1-2小时): 组件更新和功能实现
3. **第三阶段** (30分钟): 测试和验证
4. **第四阶段** (30分钟): 文档更新和部署

## 验收标准
1. 所有文件类型都能正确上传到服务器
2. 图片缩略图正确生成和显示
3. 文件删除功能正常工作
4. 错误处理和用户提示完善
5. 无控制台错误或警告
6. 响应式设计在各设备上正常工作
