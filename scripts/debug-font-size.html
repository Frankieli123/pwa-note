<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­—ä½“å¤§å°è°ƒè¯•å·¥å…·</title>
    <style>
        /* å¤åˆ¶é¡¹ç›®çš„å­—ä½“ç³»ç»Ÿ */
        :root {
            --base-font-size: 0.95rem;
            --font-size-xs: calc(var(--base-font-size) * 0.75);
            --font-size-sm: calc(var(--base-font-size) * 0.875);
            --font-size-base: var(--base-font-size);
            --font-size-lg: calc(var(--base-font-size) * 1.125);
        }

        :root[data-font-size="small"] {
            --base-font-size: 0.8rem;
        }

        :root[data-font-size="medium"] {
            --base-font-size: 0.95rem;
        }

        :root[data-font-size="large"] {
            --base-font-size: 1.1rem;
        }

        :root[data-font-size="x-large"] {
            --base-font-size: 1.3rem;
        }

        .text-base {
            font-size: var(--font-size-base) !important;
        }

        .test-input {
            padding: 8px 12px;
            border: 2px solid #007bff;
            border-radius: 4px;
            margin: 10px 0;
            width: 100%;
            max-width: 400px;
        }

        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            line-height: 1.6;
        }

        .debug-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .controls {
            margin: 20px 0;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 8px;
        }

        button {
            margin: 5px;
            padding: 10px 20px;
            border: 1px solid #007bff;
            background: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        button:hover {
            background: #0056b3;
        }

        button.active {
            background: #28a745;
            border-color: #28a745;
        }

        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .info-table th, .info-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .info-table th {
            background: #f5f5f5;
        }

        .current-size {
            font-weight: bold;
            color: #007bff;
            font-size: 18px;
        }

        .problem {
            background: #ffebee;
            border: 2px solid #f44336;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .solution {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>å­—ä½“å¤§å°è°ƒè¯•å·¥å…·</h1>
    
    <div class="problem">
        <h3>ğŸ› ç”¨æˆ·åé¦ˆçš„é—®é¢˜</h3>
        <p><strong>ç°è±¡</strong>ï¼šè®¾ç½®ä¸ºå°å·æ—¶ï¼Œè¾“å…¥æ¡†æ˜¾ç¤ºå¤§å·ï¼›è®¾ç½®ä¸ºå¤§å·æ—¶ï¼Œè¾“å…¥æ¡†æ˜¾ç¤ºå°å·</p>
        <p><strong>æœŸæœ›</strong>ï¼šè®¾ç½®ä»€ä¹ˆå¤§å°ï¼Œè¾“å…¥æ¡†å°±æ˜¾ç¤ºä»€ä¹ˆå¤§å°</p>
    </div>

    <div class="controls">
        <h3>ğŸ›ï¸ å­—ä½“å¤§å°æ§åˆ¶</h3>
        <button id="btn-small" onclick="setFontSize('small')">å°å· (Small)</button>
        <button id="btn-medium" onclick="setFontSize('medium')" class="active">ä¸­å· (Medium)</button>
        <button id="btn-large" onclick="setFontSize('large')">å¤§å· (Large)</button>
        <button id="btn-x-large" onclick="setFontSize('x-large')">ç‰¹å¤§å· (X-Large)</button>
        <p>å½“å‰è®¾ç½®ï¼š<span id="currentSetting" class="current-size">medium (ä¸­å·)</span></p>
    </div>

    <div class="debug-section">
        <h3>ğŸ“ å®é™…å­—ä½“å¤§å°æµ‹é‡</h3>
        <input type="text" class="test-input text-base" id="testInput" value="æµ‹è¯•è¾“å…¥æ¡† - è¿™é‡Œåº”è¯¥è·Ÿéšå­—ä½“è®¾ç½®" placeholder="è¾“å…¥ä¸€äº›æ–‡å­—æµ‹è¯•">
        
        <table class="info-table">
            <thead>
                <tr>
                    <th>CSSå˜é‡</th>
                    <th>è®¡ç®—å€¼</th>
                    <th>åƒç´ å€¼</th>
                </tr>
            </thead>
            <tbody id="cssVariables">
                <!-- åŠ¨æ€å¡«å…… -->
            </tbody>
        </table>
    </div>

    <div class="debug-section">
        <h3>ğŸ” è¾“å…¥æ¡†å®é™…å­—ä½“å¤§å°</h3>
        <p>è¾“å…¥æ¡†è®¡ç®—åçš„å­—ä½“å¤§å°ï¼š<span id="actualFontSize" class="current-size">--</span></p>
        <p>è¾“å…¥æ¡†ä½¿ç”¨çš„CSSç±»ï¼š<code>text-base</code></p>
        <p>text-baseå¯¹åº”çš„CSSå˜é‡ï¼š<code>var(--font-size-base)</code></p>
    </div>

    <div class="debug-section">
        <h3>ğŸ“Š å­—ä½“å¤§å°å¯¹ç…§è¡¨</h3>
        <table class="info-table">
            <thead>
                <tr>
                    <th>ç”¨æˆ·è®¾ç½®</th>
                    <th>æœŸæœ›æ•ˆæœ</th>
                    <th>--base-font-size</th>
                    <th>å®é™…åƒç´ å€¼</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>å°å· (small)</td>
                    <td>è¾“å…¥æ¡†åº”è¯¥æ˜¾ç¤ºå°å­—ä½“</td>
                    <td>0.8rem</td>
                    <td id="small-px">--</td>
                </tr>
                <tr>
                    <td>ä¸­å· (medium)</td>
                    <td>è¾“å…¥æ¡†åº”è¯¥æ˜¾ç¤ºä¸­ç­‰å­—ä½“</td>
                    <td>0.95rem</td>
                    <td id="medium-px">--</td>
                </tr>
                <tr>
                    <td>å¤§å· (large)</td>
                    <td>è¾“å…¥æ¡†åº”è¯¥æ˜¾ç¤ºå¤§å­—ä½“</td>
                    <td>1.1rem</td>
                    <td id="large-px">--</td>
                </tr>
                <tr>
                    <td>ç‰¹å¤§å· (x-large)</td>
                    <td>è¾“å…¥æ¡†åº”è¯¥æ˜¾ç¤ºç‰¹å¤§å­—ä½“</td>
                    <td>1.3rem</td>
                    <td id="x-large-px">--</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="solution">
        <h3>ğŸ’¡ è¯Šæ–­ç»“æœ</h3>
        <div id="diagnosis">
            <p>æ­£åœ¨æ£€æµ‹...</p>
        </div>
    </div>

    <script>
        let currentSize = 'medium';

        function setFontSize(size) {
            currentSize = size;
            
            // æ›´æ–°DOMå±æ€§
            document.documentElement.setAttribute('data-font-size', size);
            document.getElementById('currentSetting').textContent = `${size} (${getSizeLabel(size)})`;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${size}`).classList.add('active');
            
            // æ›´æ–°è°ƒè¯•ä¿¡æ¯
            updateDebugInfo();
        }

        function getSizeLabel(size) {
            const labels = {
                'small': 'å°å·',
                'medium': 'ä¸­å·', 
                'large': 'å¤§å·',
                'x-large': 'ç‰¹å¤§å·'
            };
            return labels[size] || size;
        }

        function updateDebugInfo() {
            const input = document.getElementById('testInput');
            const computedStyle = getComputedStyle(input);
            const actualFontSize = computedStyle.fontSize;
            
            // æ›´æ–°å®é™…å­—ä½“å¤§å°
            document.getElementById('actualFontSize').textContent = actualFontSize;
            
            // æ›´æ–°CSSå˜é‡è¡¨
            const cssVariablesTable = document.getElementById('cssVariables');
            const rootStyle = getComputedStyle(document.documentElement);
            
            const variables = [
                '--base-font-size',
                '--font-size-xs', 
                '--font-size-sm',
                '--font-size-base',
                '--font-size-lg'
            ];
            
            cssVariablesTable.innerHTML = variables.map(variable => {
                const value = rootStyle.getPropertyValue(variable);
                const pixelValue = convertRemToPx(value);
                return `
                    <tr>
                        <td><code>${variable}</code></td>
                        <td>${value}</td>
                        <td>${pixelValue}px</td>
                    </tr>
                `;
            }).join('');
            
            // æ›´æ–°å¯¹ç…§è¡¨çš„åƒç´ å€¼
            ['small', 'medium', 'large', 'x-large'].forEach(size => {
                const tempDiv = document.createElement('div');
                tempDiv.setAttribute('data-font-size', size);
                document.body.appendChild(tempDiv);
                
                // ä¸´æ—¶è®¾ç½®å±æ€§æ¥è·å–è®¡ç®—å€¼
                const originalAttr = document.documentElement.getAttribute('data-font-size');
                document.documentElement.setAttribute('data-font-size', size);
                
                const baseSize = rootStyle.getPropertyValue('--base-font-size');
                const pixelValue = convertRemToPx(baseSize);
                
                document.getElementById(`${size}-px`).textContent = `${pixelValue}px`;
                
                // æ¢å¤åŸå§‹å±æ€§
                document.documentElement.setAttribute('data-font-size', originalAttr);
                document.body.removeChild(tempDiv);
            });
            
            // è¯Šæ–­ç»“æœ
            diagnose();
        }

        function convertRemToPx(remValue) {
            if (!remValue || !remValue.includes('rem')) return '0';
            const remNumber = parseFloat(remValue);
            const rootFontSize = parseFloat(getComputedStyle(document.documentElement).fontSize);
            return Math.round(remNumber * rootFontSize);
        }

        function diagnose() {
            const input = document.getElementById('testInput');
            const actualFontSize = parseFloat(getComputedStyle(input).fontSize);
            
            // è·å–æœŸæœ›çš„å­—ä½“å¤§å°
            const expectedSizes = {
                'small': 0.8,
                'medium': 0.95,
                'large': 1.1,
                'x-large': 1.3
            };
            
            const rootFontSize = parseFloat(getComputedStyle(document.documentElement).fontSize);
            const expectedPx = expectedSizes[currentSize] * rootFontSize;
            
            const diagnosis = document.getElementById('diagnosis');
            
            if (Math.abs(actualFontSize - expectedPx) < 1) {
                diagnosis.innerHTML = `
                    <p style="color: green;">âœ… <strong>å­—ä½“å¤§å°æ­£ç¡®</strong></p>
                    <p>è®¾ç½®ï¼š${getSizeLabel(currentSize)} | æœŸæœ›ï¼š${expectedPx.toFixed(1)}px | å®é™…ï¼š${actualFontSize}px</p>
                    <p>å­—ä½“ç³»ç»Ÿå·¥ä½œæ­£å¸¸ï¼</p>
                `;
            } else {
                diagnosis.innerHTML = `
                    <p style="color: red;">âŒ <strong>å­—ä½“å¤§å°ä¸åŒ¹é…</strong></p>
                    <p>è®¾ç½®ï¼š${getSizeLabel(currentSize)} | æœŸæœ›ï¼š${expectedPx.toFixed(1)}px | å®é™…ï¼š${actualFontSize}px</p>
                    <p>å·®å¼‚ï¼š${(actualFontSize - expectedPx).toFixed(1)}px</p>
                    <p><strong>å¯èƒ½çš„åŸå› ï¼š</strong></p>
                    <ul>
                        <li>CSSå˜é‡æ²¡æœ‰æ­£ç¡®åº”ç”¨</li>
                        <li>æµè§ˆå™¨ç¼“å­˜é—®é¢˜</li>
                        <li>CSSä¼˜å…ˆçº§å†²çª</li>
                        <li>data-font-sizeå±æ€§æ²¡æœ‰æ­£ç¡®è®¾ç½®</li>
                    </ul>
                `;
            }
        }

        // åˆå§‹åŒ–
        setFontSize('medium');
        
        // ç›‘å¬çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', updateDebugInfo);
    </script>
</body>
</html>
