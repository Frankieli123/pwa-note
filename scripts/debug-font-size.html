<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>字体大小调试工具</title>
    <style>
        /* 复制项目的字体系统 */
        :root {
            --base-font-size: 0.95rem;
            --font-size-xs: calc(var(--base-font-size) * 0.75);
            --font-size-sm: calc(var(--base-font-size) * 0.875);
            --font-size-base: var(--base-font-size);
            --font-size-lg: calc(var(--base-font-size) * 1.125);
        }

        :root[data-font-size="small"] {
            --base-font-size: 0.8rem;
        }

        :root[data-font-size="medium"] {
            --base-font-size: 0.95rem;
        }

        :root[data-font-size="large"] {
            --base-font-size: 1.1rem;
        }

        :root[data-font-size="x-large"] {
            --base-font-size: 1.3rem;
        }

        .text-base {
            font-size: var(--font-size-base) !important;
        }

        .test-input {
            padding: 8px 12px;
            border: 2px solid #007bff;
            border-radius: 4px;
            margin: 10px 0;
            width: 100%;
            max-width: 400px;
        }

        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            line-height: 1.6;
        }

        .debug-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .controls {
            margin: 20px 0;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 8px;
        }

        button {
            margin: 5px;
            padding: 10px 20px;
            border: 1px solid #007bff;
            background: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        button:hover {
            background: #0056b3;
        }

        button.active {
            background: #28a745;
            border-color: #28a745;
        }

        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .info-table th, .info-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .info-table th {
            background: #f5f5f5;
        }

        .current-size {
            font-weight: bold;
            color: #007bff;
            font-size: 18px;
        }

        .problem {
            background: #ffebee;
            border: 2px solid #f44336;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .solution {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>字体大小调试工具</h1>
    
    <div class="problem">
        <h3>🐛 用户反馈的问题</h3>
        <p><strong>现象</strong>：设置为小号时，输入框显示大号；设置为大号时，输入框显示小号</p>
        <p><strong>期望</strong>：设置什么大小，输入框就显示什么大小</p>
    </div>

    <div class="controls">
        <h3>🎛️ 字体大小控制</h3>
        <button id="btn-small" onclick="setFontSize('small')">小号 (Small)</button>
        <button id="btn-medium" onclick="setFontSize('medium')" class="active">中号 (Medium)</button>
        <button id="btn-large" onclick="setFontSize('large')">大号 (Large)</button>
        <button id="btn-x-large" onclick="setFontSize('x-large')">特大号 (X-Large)</button>
        <p>当前设置：<span id="currentSetting" class="current-size">medium (中号)</span></p>
    </div>

    <div class="debug-section">
        <h3>📏 实际字体大小测量</h3>
        <input type="text" class="test-input text-base" id="testInput" value="测试输入框 - 这里应该跟随字体设置" placeholder="输入一些文字测试">
        
        <table class="info-table">
            <thead>
                <tr>
                    <th>CSS变量</th>
                    <th>计算值</th>
                    <th>像素值</th>
                </tr>
            </thead>
            <tbody id="cssVariables">
                <!-- 动态填充 -->
            </tbody>
        </table>
    </div>

    <div class="debug-section">
        <h3>🔍 输入框实际字体大小</h3>
        <p>输入框计算后的字体大小：<span id="actualFontSize" class="current-size">--</span></p>
        <p>输入框使用的CSS类：<code>text-base</code></p>
        <p>text-base对应的CSS变量：<code>var(--font-size-base)</code></p>
    </div>

    <div class="debug-section">
        <h3>📊 字体大小对照表</h3>
        <table class="info-table">
            <thead>
                <tr>
                    <th>用户设置</th>
                    <th>期望效果</th>
                    <th>--base-font-size</th>
                    <th>实际像素值</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>小号 (small)</td>
                    <td>输入框应该显示小字体</td>
                    <td>0.8rem</td>
                    <td id="small-px">--</td>
                </tr>
                <tr>
                    <td>中号 (medium)</td>
                    <td>输入框应该显示中等字体</td>
                    <td>0.95rem</td>
                    <td id="medium-px">--</td>
                </tr>
                <tr>
                    <td>大号 (large)</td>
                    <td>输入框应该显示大字体</td>
                    <td>1.1rem</td>
                    <td id="large-px">--</td>
                </tr>
                <tr>
                    <td>特大号 (x-large)</td>
                    <td>输入框应该显示特大字体</td>
                    <td>1.3rem</td>
                    <td id="x-large-px">--</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="solution">
        <h3>💡 诊断结果</h3>
        <div id="diagnosis">
            <p>正在检测...</p>
        </div>
    </div>

    <script>
        let currentSize = 'medium';

        function setFontSize(size) {
            currentSize = size;
            
            // 更新DOM属性
            document.documentElement.setAttribute('data-font-size', size);
            document.getElementById('currentSetting').textContent = `${size} (${getSizeLabel(size)})`;
            
            // 更新按钮状态
            document.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${size}`).classList.add('active');
            
            // 更新调试信息
            updateDebugInfo();
        }

        function getSizeLabel(size) {
            const labels = {
                'small': '小号',
                'medium': '中号', 
                'large': '大号',
                'x-large': '特大号'
            };
            return labels[size] || size;
        }

        function updateDebugInfo() {
            const input = document.getElementById('testInput');
            const computedStyle = getComputedStyle(input);
            const actualFontSize = computedStyle.fontSize;
            
            // 更新实际字体大小
            document.getElementById('actualFontSize').textContent = actualFontSize;
            
            // 更新CSS变量表
            const cssVariablesTable = document.getElementById('cssVariables');
            const rootStyle = getComputedStyle(document.documentElement);
            
            const variables = [
                '--base-font-size',
                '--font-size-xs', 
                '--font-size-sm',
                '--font-size-base',
                '--font-size-lg'
            ];
            
            cssVariablesTable.innerHTML = variables.map(variable => {
                const value = rootStyle.getPropertyValue(variable);
                const pixelValue = convertRemToPx(value);
                return `
                    <tr>
                        <td><code>${variable}</code></td>
                        <td>${value}</td>
                        <td>${pixelValue}px</td>
                    </tr>
                `;
            }).join('');
            
            // 更新对照表的像素值
            ['small', 'medium', 'large', 'x-large'].forEach(size => {
                const tempDiv = document.createElement('div');
                tempDiv.setAttribute('data-font-size', size);
                document.body.appendChild(tempDiv);
                
                // 临时设置属性来获取计算值
                const originalAttr = document.documentElement.getAttribute('data-font-size');
                document.documentElement.setAttribute('data-font-size', size);
                
                const baseSize = rootStyle.getPropertyValue('--base-font-size');
                const pixelValue = convertRemToPx(baseSize);
                
                document.getElementById(`${size}-px`).textContent = `${pixelValue}px`;
                
                // 恢复原始属性
                document.documentElement.setAttribute('data-font-size', originalAttr);
                document.body.removeChild(tempDiv);
            });
            
            // 诊断结果
            diagnose();
        }

        function convertRemToPx(remValue) {
            if (!remValue || !remValue.includes('rem')) return '0';
            const remNumber = parseFloat(remValue);
            const rootFontSize = parseFloat(getComputedStyle(document.documentElement).fontSize);
            return Math.round(remNumber * rootFontSize);
        }

        function diagnose() {
            const input = document.getElementById('testInput');
            const actualFontSize = parseFloat(getComputedStyle(input).fontSize);
            
            // 获取期望的字体大小
            const expectedSizes = {
                'small': 0.8,
                'medium': 0.95,
                'large': 1.1,
                'x-large': 1.3
            };
            
            const rootFontSize = parseFloat(getComputedStyle(document.documentElement).fontSize);
            const expectedPx = expectedSizes[currentSize] * rootFontSize;
            
            const diagnosis = document.getElementById('diagnosis');
            
            if (Math.abs(actualFontSize - expectedPx) < 1) {
                diagnosis.innerHTML = `
                    <p style="color: green;">✅ <strong>字体大小正确</strong></p>
                    <p>设置：${getSizeLabel(currentSize)} | 期望：${expectedPx.toFixed(1)}px | 实际：${actualFontSize}px</p>
                    <p>字体系统工作正常！</p>
                `;
            } else {
                diagnosis.innerHTML = `
                    <p style="color: red;">❌ <strong>字体大小不匹配</strong></p>
                    <p>设置：${getSizeLabel(currentSize)} | 期望：${expectedPx.toFixed(1)}px | 实际：${actualFontSize}px</p>
                    <p>差异：${(actualFontSize - expectedPx).toFixed(1)}px</p>
                    <p><strong>可能的原因：</strong></p>
                    <ul>
                        <li>CSS变量没有正确应用</li>
                        <li>浏览器缓存问题</li>
                        <li>CSS优先级冲突</li>
                        <li>data-font-size属性没有正确设置</li>
                    </ul>
                `;
            }
        }

        // 初始化
        setFontSize('medium');
        
        // 监听窗口大小变化
        window.addEventListener('resize', updateDebugInfo);
    </script>
</body>
</html>
